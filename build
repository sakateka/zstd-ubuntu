#! /bin/bash
set -eux

DEBVERSION=1.3.1
DEBFULLNAME="$(git config --get user.name)"
DEBEMAIL="$(git config --get user.email)"

echo "Building $DEBVERSION.de"

for dist in xenial trusty precise lucid; do
    docker build -f Dockerfile-$dist \
                 --build-arg DEBVERSION=$DEBVERSION \
                 --build-arg DEBFULLNAME="$DEBFULLNAME" \
                 --build-arg DEBEMAIL="$DEBEMAIL" \
         -t zstd-bundle-deb-$dist . || echo "Failed to build image"
    CONTAINER=$(docker create zstd-bundle-deb-$dist)
    mkdir -p $dist
    docker cp $CONTAINER:/build/artifacts ./$dist/
    docker rm $CONTAINER
done
